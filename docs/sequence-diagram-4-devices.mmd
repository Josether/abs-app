sequenceDiagram
    actor Admin as Administrator
    participant UI as Frontend UI
    participant API as Backend API
    participant Crypto as Crypto Service
    participant Worker as Netmiko Worker
    participant Device as Network Device
    participant DB as Database
    participant Audit as Audit Log
    
    Admin->>UI: Buka menu Devices
    UI->>API: Request daftar device
    API->>DB: Ambil data device
    DB-->>API: Return device list
    API-->>UI: Return devices data
    UI->>Admin: Tampilkan daftar perangkat
    
    alt Add Device
        Admin->>UI: Klik Add Device
        UI->>Admin: Tampilkan form input perangkat
        Admin->>UI: Isi form device
        UI->>API: Kirim data device baru
        API->>Crypto: Enkripsi kredensial
        Crypto-->>API: Return data terenkripsi
        API->>DB: Simpan device baru
        DB-->>API: Device tersimpan
        API->>Audit: Log device_create
        Audit->>DB: Simpan log audit
        API-->>UI: Return sukses
        UI->>Admin: Tampilkan device berhasil ditambahkan
        
    else Edit Device
        Admin->>UI: Klik Edit Device
        UI->>Admin: Tampilkan form edit
        Admin->>UI: Update data perangkat
        UI->>API: Kirim perubahan data
        API->>Crypto: Enkripsi kredensial baru (jika ada)
        Crypto-->>API: Return data terenkripsi
        API->>DB: Update device
        DB-->>API: Device terupdate
        API->>Audit: Log device_update
        Audit->>DB: Simpan log audit
        API-->>UI: Return sukses
        UI->>Admin: Tampilkan perubahan tersimpan
        
    else Delete Device
        Admin->>UI: Klik Delete Device
        UI->>API: Request hapus device
        API->>DB: Hapus device
        DB-->>API: Device dihapus
        API->>Audit: Log device_delete
        Audit->>DB: Simpan log audit
        API-->>UI: Return sukses
        UI->>Admin: Tampilkan device berhasil dihapus
        
    else Test Connection
        Admin->>UI: Klik Test Connection
        UI->>API: Request test koneksi
        API->>Crypto: Dekripsi kredensial
        Crypto-->>API: Return kredensial
        API->>Worker: Test koneksi device
        Worker->>Device: Koneksi ke device
        
        alt Connection Success
            Device-->>Worker: Koneksi berhasil
            Worker-->>API: Return sukses
            API-->>UI: Return status berhasil
            UI->>Admin: Tampilkan hasil: Koneksi berhasil
        else Connection Failed
            Device-->>Worker: Koneksi gagal
            Worker-->>API: Return failed + error message
            API-->>UI: Return {status: failed, error}
            UI->>Admin: Tampilkan hasil: Koneksi gagal
        end
    end
