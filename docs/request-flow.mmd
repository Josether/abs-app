sequenceDiagram
    participant U as User
    participant FE as Frontend (Next.js)
    participant BE as FastAPI (Routers)
    participant SEC as Security (JWT)
    participant SVC as Services (Netmiko/Scheduler)
    participant DB as SQLite
    participant FS as Backup Files

    U->>FE: Input credentials
    FE->>BE: POST /auth/login
    BE->>SEC: Validate & issue JWT
    SEC-->>BE: JWT token
    BE-->>FE: Token + role
    FE->>FE: Store abs_token & abs_user (localStorage)

    U->>FE: Navigate Devices
    FE->>BE: GET /devices (Bearer)
    BE->>SEC: Verify token
    BE->>DB: Query devices
    DB-->>BE: Device list
    BE-->>FE: JSON devices

    U->>FE: Run Manual Backup
    FE->>BE: POST /jobs/run/manual
    BE->>DB: Insert Job (running)
    BE->>SVC: Enqueue job
    SVC->>DB: Fetch enabled devices
    loop Per device
        SVC->>Netmiko: fetch_running_config()
        Netmiko->>Device: SSH/Telnet commands
        Netmiko->>FS: Write config file
        Netmiko->>DB: Insert Backup record
    end
    SVC->>DB: Update Job (success + log)

    FE->>BE: GET /jobs/{id}
    BE->>DB: Query job + log
    BE-->>FE: Job detail response